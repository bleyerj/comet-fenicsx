

<!DOCTYPE html>


<html lang="en" data-content_root="" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Cohesive zone modelling of debonding and bulk fracture &#8212; Computational Mechanics Numerical Tours with FEniCSx</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../_static/styles/theme.css?digest=5b4479735964841361fd" rel="stylesheet" />
<link href="../../../_static/styles/bootstrap.css?digest=5b4479735964841361fd" rel="stylesheet" />
<link href="../../../_static/styles/pydata-sphinx-theme.css?digest=5b4479735964841361fd" rel="stylesheet" />

  
  <link href="../../../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=5b4479735964841361fd" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" href="../../../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/custom.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/custom.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/custom.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../_static/scripts/bootstrap.js?digest=5b4479735964841361fd" />
<link rel="preload" as="script" href="../../../_static/scripts/pydata-sphinx-theme.js?digest=5b4479735964841361fd" />
  <script src="../../../_static/vendor/fontawesome/6.1.2/js/all.min.js?digest=5b4479735964841361fd"></script>

    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/clipboard.min.js"></script>
    <script src="../../../_static/copybutton.js"></script>
    <script src="../../../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'tours/nonlinear_problems/cohesive_zone_model/cohesive_zone_model';</script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>

  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="../../../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../../_static/logo.png" class="logo__image only-light" alt="Computational Mechanics Numerical Tours with FEniCSx - Home"/>
    <script>document.write(`<img src="../../../_static/logo.png" class="logo__image only-dark" alt="Computational Mechanics Numerical Tours with FEniCSx - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../../index.html">
                    Welcome
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Introduction</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../../intro/linear_elasticity/linear_elasticity.html">Linear elasticity</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../intro/hyperelasticity/hyperelasticity.html">Hyperelasticity</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../intro/plates/plates.html">Reissner-Mindlin plates</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Tours</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../linear_problems/contents.html">Linear problems</a><input checked class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../linear_problems/isotropic_orthotropic_elasticity/isotropic_orthotropic_elasticity.html">Isotropic and orthotropic plane stress elasticity <span class="far fa-star"></span></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../linear_problems/axisymmetric_elasticity/axisymmetric_elasticity.html">Axisymmetric formulation for elastic structures of revolution <span class="far fa-star"></span></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../linear_problems/thermoelasticity_weak/thermoelasticity_weak.html">Linear thermoelasticity (weak coupling) <span class="far fa-star"></span></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../linear_problems/thermoelasticity_full/thermoelasticity_full.html">Thermo-elastic evolution problem (full coupling) <span class="far fa-star"></span><span class="far fa-star"></span></a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../plates/contents.html">Plates</a><input checked class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-2"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../plates/reissner_mindlin_quads/reissner_mindlin_quads.html">Shear-locking in thick plate models with quadrilateral elements  <span class="far fa-star"></span></a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../contents.html">Nonlinear problems</a><input checked class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-3"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../plasticity/plasticity.html">Elasto-plastic analysis of a 2D von Mises material</a></li>
<li class="toctree-l2"><a class="reference internal" href="../bound_constrained/bound_constrained.html">Localized 1D solutions in phase-field approach to brittle fracture <span class="far fa-star"></span><span class="far fa-star"></span></a></li>
</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Tips and tricks</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../../tips/mark_facets/mark_facets.html">Marking facets with geometrical functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tips/import_msh/import_msh.html">Importing a <code class="docutils literal notranslate"><span class="pre">.msh</span></code> file</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tips/piecewise_constant_field/piecewise_constant_field.html">Create a piecewise constant field for spatially varying properties</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tips/mass_lumping/mass_lumping.html">Lumping a mass matrix</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tips/quadrature_schemes/quadrature_schemes.html">Quadrature schemes</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/bleyerj/comet-fenicsx" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/bleyerj/comet-fenicsx/edit/main/tours/nonlinear_problems/cohesive_zone_model/cohesive_zone_model.ipynb" target="_blank"
   class="btn btn-sm btn-source-edit-button dropdown-item"
   title="Suggest edit"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="btn__text-container">Suggest edit</span>
</a>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Cohesive zone modelling of debonding and bulk fracture</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#traction-separation-law">Traction-separation law</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#nonlinear-resolution">Nonlinear resolution</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#fenics-implementation">FEniCS implementation</a><ul class="visible nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#mesh-and-domains">Mesh and domains</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#function-spaces-and-functions">Function spaces and functions</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#projection-onto-cells-and-facets">Projection onto cells and facets</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Traction-separation law</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#dirichlet-boundary-conditions">Dirichlet boundary conditions</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#variational-form-and-linear-solver">Variational form and linear solver</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#load-stepping-loop">Load-stepping loop</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#force-displacement-and-opening-evolutions">Force-displacement and opening evolutions</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#references">References</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="cohesive-zone-modelling-of-debonding-and-bulk-fracture">
<h1>Cohesive zone modelling of debonding and bulk fracture<a class="headerlink" href="#cohesive-zone-modelling-of-debonding-and-bulk-fracture" title="Permalink to this heading">#</a></h1>
<p><span class="math notranslate nohighlight">\(\newcommand{\bu}{\boldsymbol{u}}\newcommand{\bv}{\boldsymbol{v}}
\newcommand{\bn}{\boldsymbol{n}}
\newcommand{\bt}{\boldsymbol{t}}\newcommand{\bT}{\boldsymbol{T}}
\newcommand{\jump}[1]{[\![#1]\!]}\)</span></p>
<p>This numerical tour will show how we can formulate a cohesive fracture model with FEniCS. We adopt here an intrinsic cohesive zone model where cohesive elements are considered along all internal facets of the mesh. We will use for this purpose a Discontinuous Galerkin interpolation of the displacement field. The reader can also refer to <span class="xref myst">[HAN15]</span> for a related work.</p>
<p>The problem that we consider is a heterogeneous elastic plate with cohesive elements along the interface. The left part of the plate is fixed whereas the right part is subjected to an imposed displacement <span class="math notranslate nohighlight">\(\bu=(u(t), 0)\)</span>.</p>
<section id="traction-separation-law">
<h2>Traction-separation law<a class="headerlink" href="#traction-separation-law" title="Permalink to this heading">#</a></h2>
<p>Cohesive zone models are interface elements characterized by a discontinuous displacement and are able to transmit forces through the interface. The link between the interface opening (displacement jump) <span class="math notranslate nohighlight">\([\![\bu]\!]\)</span> and the traction <span class="math notranslate nohighlight">\(\bT\)</span> is given by the choice of a specific constitutive law, usually refered to as a <em>traction-separation</em> law.</p>
<p>Among the many models available in the literature, we choose here one of the simplest ones, namely an exponential traction separation law given by:</p>
<div class="amsmath math notranslate nohighlight" id="equation-809c9444-b2ce-4c2b-9b03-24109a3c85a4">
<span class="eqno">()<a class="headerlink" href="#equation-809c9444-b2ce-4c2b-9b03-24109a3c85a4" title="Permalink to this equation">#</a></span>\[\begin{equation}
\bT(\jump{\bu}) = \dfrac{G_{\text{c}}}{\delta_0^2}\exp(-g_{max}/\delta_0)\jump{\bu}
\end{equation}\]</div>
<p>where <span class="math notranslate nohighlight">\(g_{max}\)</span> is the maximum effective opening displacement given by:</p>
<div class="amsmath math notranslate nohighlight" id="equation-3cb83633-d89c-4e2b-91cf-072456b393d9">
<span class="eqno">()<a class="headerlink" href="#equation-3cb83633-d89c-4e2b-91cf-072456b393d9" title="Permalink to this equation">#</a></span>\[\begin{align}
g_{max}(t)&amp;:=\max_{t'\in[0;t]} g(t') \\
g(t) &amp;:= \sqrt{[\![u_n(t)]\!]^2+\beta[\![u_t(t)]\!]^2}
\end{align}\]</div>
<p>and where <span class="math notranslate nohighlight">\(\beta\)</span> is a coupling coefficient which enables to link the normal opening <span class="math notranslate nohighlight">\(\jump{u_n} = \jump{\bu}\cdot\bn\)</span> and the tangential opening <span class="math notranslate nohighlight">\(\jump{u_t}=\jump{\bu}\cdot\bt\)</span> with <span class="math notranslate nohighlight">\(\bn\)</span> (resp. <span class="math notranslate nohighlight">\(\bt\)</span>) being the unit normal (resp. tangential vector) of the considered interface.</p>
<p>Note that the above law works as a nonlinear “spring” model with a secant stiffness given by <span class="math notranslate nohighlight">\(\dfrac{G_{\text{c}}}{\delta_0^2}\exp(-g_{max}/\delta_0)\)</span>. In an unloading phase (i.e. \dot{g} &lt; 0), the stiffness does not evolve and the interface acts as a linear elastic spring. In a loading phase for which \dot{g}&gt;0 and <span class="math notranslate nohighlight">\(g = g_\text{max}\)</span>, we have a nonlinear elastic spring. For a purely normal opening <span class="math notranslate nohighlight">\((\jump{u_t}=0)\)</span> in a loading phase, we have:</p>
<div class="amsmath math notranslate nohighlight" id="equation-6f24c561-357e-429d-af2a-2109e648da32">
<span class="eqno">()<a class="headerlink" href="#equation-6f24c561-357e-429d-af2a-2109e648da32" title="Permalink to this equation">#</a></span>\[\begin{equation}
T_n(\jump{u})=\dfrac{G_{\text{c}}}{\delta_0^2}\exp(-\jump{u}/\delta_0)\jump{u}
\end{equation}\]</div>
<p>which is maximum when <span class="math notranslate nohighlight">\(\jump{u}=\delta_0\)</span> with a value <span class="math notranslate nohighlight">\(T_n(\delta_0) = \sigma_0 = \dfrac{G_{\text{c}}}{\delta_0^2}\exp(-1)\)</span>. <span class="math notranslate nohighlight">\(\delta_0\)</span> therefore characterizes the critical opening for which the maximum strength <span class="math notranslate nohighlight">\(\sigma_0\)</span> is reached. For <span class="math notranslate nohighlight">\(\jump{u}\gg \delta_0\)</span>, the stiffness vanishes and the cohesive element does not sustain any load anymore. Finally, when integrating the traction-separation law for <span class="math notranslate nohighlight">\(\jump{u}\)</span> from 0 to <span class="math notranslate nohighlight">\(+\infty\)</span>, we see that the total dissipated surface energy is:</p>
<div class="amsmath math notranslate nohighlight" id="equation-0f126574-775f-476f-87c5-8c10d470d084">
<span class="eqno">()<a class="headerlink" href="#equation-0f126574-775f-476f-87c5-8c10d470d084" title="Permalink to this equation">#</a></span>\[\begin{equation}
\text{Dissipation} = \int_0^{+\infty} T_n(\jump{u})d\jump{u} = G_\text{c}
\end{equation}\]</div>
<p>which is then the fracture energy spent when completely opening the interface.</p>
<p>The following script illustrates the pure normal opening behaviour of the exponential cohesive law along a few loading/unloading cycles.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">clear_output</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="o">%</span><span class="k">matplotlib</span> inline

<span class="n">delta_0</span> <span class="o">=</span> <span class="mf">1.</span>
<span class="n">Gc</span> <span class="o">=</span> <span class="mf">1.</span>
<span class="n">sig_0</span> <span class="o">=</span> <span class="n">Gc</span><span class="o">/</span><span class="n">delta_0</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">loading_cycles</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">delta_0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="o">*</span><span class="n">delta_0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">8</span><span class="o">*</span><span class="n">delta_0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
<span class="n">loading_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">])]</span>
<span class="k">for</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">loading_cycles</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">loading_cycles</span><span class="p">[</span><span class="mi">1</span><span class="p">:]):</span>
    <span class="n">loading_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="mi">21</span><span class="p">)[</span><span class="mi">1</span><span class="p">:])</span>
<span class="n">loading</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">loading_list</span><span class="p">)</span>

<span class="n">g_max</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">T</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">loading</span><span class="p">)</span>
<span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">u</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">loading</span><span class="p">):</span>
    <span class="n">g_max</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">u</span><span class="p">),</span> <span class="n">g_max</span><span class="p">)</span>
    <span class="n">T</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">Gc</span><span class="o">/</span><span class="n">delta_0</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">g_max</span><span class="o">/</span><span class="n">delta_0</span><span class="p">)</span><span class="o">*</span><span class="n">u</span><span class="o">/</span><span class="n">sig_0</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">loading</span><span class="p">[:</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span> <span class="n">T</span><span class="p">[:</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;-k&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">loading</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">T</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="s1">&#39;ok&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">loading_cycles</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">loading_cycles</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Normalized opening $[\![u]\!]/\delta_0$&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Normalized traction $T([\![u]\!])/\sigma_0$&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="n">clear_output</span><span class="p">(</span><span class="n">wait</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/4c8bbeedc55f7ef41da4c44f39cf4c0e8c8b9752cdf3f44882894e482f31c5ce.png" src="../../../_images/4c8bbeedc55f7ef41da4c44f39cf4c0e8c8b9752cdf3f44882894e482f31c5ce.png" />
</div>
</div>
<blockquote>
<div><p>Note that we do not distinguish here the tensile from the compressive regime. In practice, an asymmetric formulation should be considered, for instance with a high stiffness in compression to approximate a unilateral contact behaviour.</p>
</div></blockquote>
</section>
<section id="nonlinear-resolution">
<h2>Nonlinear resolution<a class="headerlink" href="#nonlinear-resolution" title="Permalink to this heading">#</a></h2>
<p>The above traction-separation law is highly nonlinear. Newton-Raphson method is not necessarily extremely robust in such softening situations, especially in the presence of unstable crack propagation phases. For this reason, we prefer here to resort to a fixed-point iteration scheme in which, for a given load step, we solve an elastic displacement problem with <span class="math notranslate nohighlight">\(g_\text{max}\)</span> being fixed to a previously known value:</p>
<div class="amsmath math notranslate nohighlight" id="equation-8f2a740b-2638-4c3e-acca-11b95bd21589">
<span class="eqno">()<a class="headerlink" href="#equation-8f2a740b-2638-4c3e-acca-11b95bd21589" title="Permalink to this equation">#</a></span>\[\begin{equation}
\mathbf{K}^{(i)}\mathbf{U}^{(i+1)} = \mathbf{F}
\end{equation}\]</div>
<p>where <span class="math notranslate nohighlight">\(\mathbf{K}^{(i)}\)</span> denotes the elastic stiffness matrix evaluated using the value of <span class="math notranslate nohighlight">\(g_\text{max}\)</span> corresponding to the previous displacement <span class="math notranslate nohighlight">\(\mathbf{U}^{(i)}\)</span>.</p>
<p>We then update the value of <span class="math notranslate nohighlight">\(g_\text{max}\)</span> using the newly computed displacement field <span class="math notranslate nohighlight">\(\mathbf{U}^{(i+1)}\)</span>. This process is iterated until convergence of the mechanical residual:</p>
<div class="amsmath math notranslate nohighlight" id="equation-4a67fc8a-3afa-4ac3-a0b3-7dd388a571c6">
<span class="eqno">()<a class="headerlink" href="#equation-4a67fc8a-3afa-4ac3-a0b3-7dd388a571c6" title="Permalink to this equation">#</a></span>\[\begin{equation}
\|\mathbf{K}^{(i+1)}\mathbf{U}^{(i+1)} - \mathbf{F}\|_2 &lt; \epsilon
\end{equation}\]</div>
</section>
<section id="fenics-implementation">
<h2>FEniCS implementation<a class="headerlink" href="#fenics-implementation" title="Permalink to this heading">#</a></h2>
<section id="mesh-and-domains">
<h3>Mesh and domains<a class="headerlink" href="#mesh-and-domains" title="Permalink to this heading">#</a></h3>
<p>We first import a Gmsh-generated mesh in which physical regions corresponding to the heterogeneities are labelled 2 and the matrix is labelled 1 (we plot them to check this). It also contains labels for the facets of the mesh, either exterior ones (labelled 1 and 2 for the left and right boundary respectively) or labelled 3 for the interface between the two materials. We define the volume integration measure <code class="docutils literal notranslate"><span class="pre">dx</span></code> based on the marked domains as well as the exterior facet surface measure <code class="docutils literal notranslate"><span class="pre">ds</span></code> and the inner facets surface measure <code class="docutils literal notranslate"><span class="pre">dS</span></code> based on the marked facets.</p>
<p>Note that we still need to define manually a <code class="docutils literal notranslate"><span class="pre">SubDomain</span></code> for where we will impose boundary conditions as seen later.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">mpi4py</span> <span class="kn">import</span> <span class="n">MPI</span>
<span class="kn">import</span> <span class="nn">gmsh</span>
<span class="kn">from</span> <span class="nn">dolfinx.io</span> <span class="kn">import</span> <span class="n">gmshio</span>

<span class="c1"># Create mesh using gmsh</span>
<span class="n">L</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">W</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="n">R</span> <span class="o">=</span> <span class="mf">0.25</span>
<span class="n">hsize</span> <span class="o">=</span> <span class="mf">0.66</span>

<span class="n">gmsh</span><span class="o">.</span><span class="n">initialize</span><span class="p">()</span>
<span class="n">gmsh</span><span class="o">.</span><span class="n">option</span><span class="o">.</span><span class="n">setNumber</span><span class="p">(</span><span class="s2">&quot;General.Terminal&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>  <span class="c1"># to disable meshing info</span>
<span class="n">gdim</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">model_rank</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">gmsh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;Model&quot;</span><span class="p">)</span>

<span class="n">gmsh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">occ</span><span class="o">.</span><span class="n">addRectangle</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">W</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">gmsh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">occ</span><span class="o">.</span><span class="n">addDisk</span><span class="p">(</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">gmsh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">occ</span><span class="o">.</span><span class="n">addDisk</span><span class="p">(</span><span class="mf">0.6</span><span class="p">,</span> <span class="n">W</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">gmsh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">occ</span><span class="o">.</span><span class="n">fragment</span><span class="p">([(</span><span class="n">gdim</span><span class="p">,</span> <span class="mi">1</span><span class="p">)],</span> <span class="p">[(</span><span class="n">gdim</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="n">gdim</span><span class="p">,</span> <span class="mi">3</span><span class="p">)],</span> <span class="n">removeObject</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">gmsh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">occ</span><span class="o">.</span><span class="n">synchronize</span><span class="p">()</span>

<span class="n">gmsh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">occ</span><span class="o">.</span><span class="n">remove</span><span class="p">([(</span><span class="n">gdim</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="p">(</span><span class="n">gdim</span><span class="p">,</span> <span class="mi">4</span><span class="p">)],</span> <span class="n">recursive</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">gmsh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">occ</span><span class="o">.</span><span class="n">synchronize</span><span class="p">()</span>

<span class="n">gmsh</span><span class="o">.</span><span class="n">option</span><span class="o">.</span><span class="n">setNumber</span><span class="p">(</span><span class="s2">&quot;Mesh.CharacteristicLengthMin&quot;</span><span class="p">,</span> <span class="n">hsize</span><span class="p">)</span>
<span class="n">gmsh</span><span class="o">.</span><span class="n">option</span><span class="o">.</span><span class="n">setNumber</span><span class="p">(</span><span class="s2">&quot;Mesh.CharacteristicLengthMax&quot;</span><span class="p">,</span> <span class="n">hsize</span><span class="p">)</span>

<span class="n">volumes</span> <span class="o">=</span> <span class="n">gmsh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">getEntities</span><span class="p">(</span><span class="n">gdim</span><span class="p">)</span>

<span class="n">gmsh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">addPhysicalGroup</span><span class="p">(</span><span class="n">gdim</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">1</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Matrix&quot;</span><span class="p">)</span>
<span class="n">gmsh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">addPhysicalGroup</span><span class="p">(</span><span class="n">gdim</span><span class="p">,</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="mi">2</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Inclusions&quot;</span><span class="p">)</span>


<span class="n">gmsh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">addPhysicalGroup</span><span class="p">(</span><span class="n">gdim</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="mi">1</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">)</span>
<span class="n">gmsh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">addPhysicalGroup</span><span class="p">(</span><span class="n">gdim</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="mi">7</span><span class="p">],</span> <span class="mi">2</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;right&quot;</span><span class="p">)</span>
<span class="n">gmsh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">addPhysicalGroup</span><span class="p">(</span><span class="n">gdim</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">],</span> <span class="mi">3</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;interface&quot;</span><span class="p">)</span>
<span class="n">gmsh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="n">gdim</span><span class="p">)</span>

<span class="n">domain</span><span class="p">,</span> <span class="n">subdomains</span><span class="p">,</span> <span class="n">facets</span> <span class="o">=</span> <span class="n">gmshio</span><span class="o">.</span><span class="n">model_to_mesh</span><span class="p">(</span>
    <span class="n">gmsh</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="n">MPI</span><span class="o">.</span><span class="n">COMM_WORLD</span><span class="p">,</span> <span class="n">model_rank</span><span class="p">,</span> <span class="n">gdim</span><span class="o">=</span><span class="n">gdim</span>
<span class="p">)</span>

<span class="n">gmsh</span><span class="o">.</span><span class="n">finalize</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">ufl</span>
<span class="kn">from</span> <span class="nn">dolfinx</span> <span class="kn">import</span> <span class="n">mesh</span><span class="p">,</span> <span class="n">fem</span>
<span class="kn">import</span> <span class="nn">dolfinx.fem.petsc</span>
<span class="kn">import</span> <span class="nn">dolfinx.nls.petsc</span>


<span class="n">dx</span> <span class="o">=</span> <span class="n">ufl</span><span class="o">.</span><span class="n">Measure</span><span class="p">(</span><span class="s2">&quot;dx&quot;</span><span class="p">,</span> <span class="n">subdomain_data</span><span class="o">=</span><span class="n">subdomains</span><span class="p">)</span>
<span class="n">ds</span> <span class="o">=</span> <span class="n">ufl</span><span class="o">.</span><span class="n">Measure</span><span class="p">(</span><span class="s2">&quot;ds&quot;</span><span class="p">,</span> <span class="n">subdomain_data</span><span class="o">=</span><span class="n">facets</span><span class="p">)</span>
<span class="n">dS</span> <span class="o">=</span> <span class="n">ufl</span><span class="o">.</span><span class="n">Measure</span><span class="p">(</span><span class="s2">&quot;dS&quot;</span><span class="p">,</span> <span class="n">subdomain_data</span><span class="o">=</span><span class="n">facets</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;quadrature_degree&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">})</span>
<span class="n">n</span> <span class="o">=</span> <span class="n">ufl</span><span class="o">.</span><span class="n">FacetNormal</span><span class="p">(</span><span class="n">domain</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="function-spaces-and-functions">
<h3>Function spaces and functions<a class="headerlink" href="#function-spaces-and-functions" title="Permalink to this heading">#</a></h3>
<p>The variational formulation will be based on a discontinuous interpolation of the displacements, hence we define a <strong>Discontinuous-Galerkin</strong> <code class="docutils literal notranslate"><span class="pre">&quot;DG&quot;</span></code> space for the displacement. We will also need to compute quantities which live only on the facets of the mesh but may be discontinuous from one vertex to another e.g. the internal variables of the cohesive law (the maximum gap <span class="math notranslate nohighlight">\(g_\text{max}\)</span> in the present case). The ideal solution would be here to use Quadrature elements on the mesh facets, which are unfortunately not available in FEniCS. We will instead use a <code class="docutils literal notranslate"><span class="pre">Discontinuous</span> <span class="pre">Lagrange</span> <span class="pre">Trace</span></code> (also known as <code class="docutils literal notranslate"><span class="pre">HDiv</span> <span class="pre">Trace</span></code>) space which represents polynomials living on the facet of the meshes and which are discontinuous at the vertices. A piecewise constant FunctionSpace will also serve for defining material properties.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># space for discontinuous displacement</span>
<span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="n">gdim</span><span class="p">,)</span>
<span class="n">V_u</span> <span class="o">=</span> <span class="n">fem</span><span class="o">.</span><span class="n">functionspace</span><span class="p">(</span><span class="n">domain</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;DG&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">shape</span><span class="p">))</span>
<span class="c1"># space for facet-based internal variables (maximum gap)</span>
<span class="n">V_f</span> <span class="o">=</span> <span class="n">fem</span><span class="o">.</span><span class="n">functionspace</span><span class="p">(</span><span class="n">domain</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;CR&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="c1"># space for piecewise constant material properties</span>
<span class="n">V_0</span> <span class="o">=</span> <span class="n">fem</span><span class="o">.</span><span class="n">functionspace</span><span class="p">(</span><span class="n">domain</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;DG&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>

<span class="n">u</span> <span class="o">=</span> <span class="n">fem</span><span class="o">.</span><span class="n">Function</span><span class="p">(</span><span class="n">V_u</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Displacement&quot;</span><span class="p">)</span>
<span class="n">u_</span><span class="p">,</span> <span class="n">du</span> <span class="o">=</span> <span class="n">ufl</span><span class="o">.</span><span class="n">TestFunction</span><span class="p">(</span><span class="n">V_u</span><span class="p">),</span> <span class="n">ufl</span><span class="o">.</span><span class="n">TrialFunction</span><span class="p">(</span><span class="n">V_u</span><span class="p">)</span>
<span class="n">g_max</span> <span class="o">=</span> <span class="n">fem</span><span class="o">.</span><span class="n">Function</span><span class="p">(</span><span class="n">V_f</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Maximum_opening&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="projection-onto-cells-and-facets">
<h3>Projection onto cells and facets<a class="headerlink" href="#projection-onto-cells-and-facets" title="Permalink to this heading">#</a></h3>
<p>We then define some useful functions which will enable to project expressions on facet-based finite elements like <code class="docutils literal notranslate"><span class="pre">V_f</span></code> or on cell-based finite elements like <code class="docutils literal notranslate"><span class="pre">V_0</span></code> for instance. Both functions will be able to project a UFL expression. To define piecewise constant material properties, we also make such functions able to take, as an argument, a dictionnary of values of the following kind:</p>
<p><code class="docutils literal notranslate"><span class="pre">{region_1:</span> <span class="pre">value_1,</span>&#160;&#160; <span class="pre">region_2:</span> <span class="pre">value_2,</span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span class="pre">...</span>&#160;&#160; <span class="pre">region_n:</span> <span class="pre">value_n}</span></code></p>
<p>A cell/facet-wise constant function will then be obtained with <code class="docutils literal notranslate"><span class="pre">value_i</span></code> being affected to <code class="docutils literal notranslate"><span class="pre">region_i</span></code> where <code class="docutils literal notranslate"><span class="pre">region_i</span></code> is an <code class="docutils literal notranslate"><span class="pre">int</span></code> corresponding to a given marker of the cells or facets subdomains.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">mark_entities</span><span class="p">(</span><span class="n">domain</span><span class="p">,</span> <span class="n">dim</span><span class="p">,</span> <span class="n">entities_dict</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Mark entities of specified dimension according to a geometrical marker function</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    domain : Mesh</span>
<span class="sd">        `dolfinx` mesh object</span>
<span class="sd">    dim : int</span>
<span class="sd">        Dimension of the entities to mark</span>
<span class="sd">    entities_dict : dict</span>
<span class="sd">        A dictionary mapping integer tags with a geometrical marker function {tag: marker(x)}</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    entities_tag array</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">marked_values</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">marked_entities</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c1"># number of non-ghosted entities</span>
    <span class="n">num_entities_local</span> <span class="o">=</span> <span class="n">domain</span><span class="o">.</span><span class="n">topology</span><span class="o">.</span><span class="n">index_map</span><span class="p">(</span><span class="n">dim</span><span class="p">)</span><span class="o">.</span><span class="n">size_local</span>
    <span class="c1"># Concatenate and sort the arrays based on indices</span>
    <span class="k">for</span> <span class="n">tag</span><span class="p">,</span> <span class="n">location</span> <span class="ow">in</span> <span class="n">entities_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">entities</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">locate_entities</span><span class="p">(</span><span class="n">domain</span><span class="p">,</span> <span class="n">dim</span><span class="p">,</span> <span class="n">location</span><span class="p">)</span>
        <span class="n">entities</span> <span class="o">=</span> <span class="n">entities</span><span class="p">[</span><span class="n">entities</span> <span class="o">&lt;</span> <span class="n">num_entities_local</span><span class="p">]</span>  <span class="c1"># remove ghost entities</span>
        <span class="n">marked_entities</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">entities</span><span class="p">)</span>
        <span class="n">marked_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="n">entities</span><span class="p">,</span> <span class="n">tag</span><span class="p">))</span>
    <span class="n">marked_entities</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span><span class="n">marked_entities</span><span class="p">)</span>
    <span class="n">marked_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span><span class="n">marked_values</span><span class="p">)</span>
    <span class="n">sorted_entities</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">marked_entities</span><span class="p">)</span>
    <span class="n">entities_tags</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">meshtags</span><span class="p">(</span>
        <span class="n">domain</span><span class="p">,</span> <span class="n">dim</span><span class="p">,</span> <span class="n">marked_entities</span><span class="p">[</span><span class="n">sorted_entities</span><span class="p">],</span> <span class="n">marked_values</span><span class="p">[</span><span class="n">sorted_entities</span><span class="p">]</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">entities_tags</span>


<span class="k">def</span> <span class="nf">create_piecewise_constant_field</span><span class="p">(</span><span class="n">domain</span><span class="p">,</span> <span class="n">cell_markers</span><span class="p">,</span> <span class="n">property_dict</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a piecewise constant field with different values per subdomain.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    domain : Mesh</span>
<span class="sd">        `dolfinx` mesh object</span>
<span class="sd">    cell_markers : MeshTag</span>
<span class="sd">        cell marker MeshTag</span>
<span class="sd">    property_dict : dict</span>
<span class="sd">        A dictionary mapping region tags to physical values {tag: value}</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    A DG-0 function</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">V0</span> <span class="o">=</span> <span class="n">fem</span><span class="o">.</span><span class="n">functionspace</span><span class="p">(</span><span class="n">domain</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;DG&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
    <span class="n">k</span> <span class="o">=</span> <span class="n">fem</span><span class="o">.</span><span class="n">Function</span><span class="p">(</span><span class="n">V0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">tag</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">property_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">cells</span> <span class="o">=</span> <span class="n">cell_markers</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
        <span class="n">k</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">array</span><span class="p">[</span><span class="n">cells</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="n">cells</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">k</span>


<span class="k">def</span> <span class="nf">facet_project</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">V</span><span class="p">):</span>
    <span class="n">v_</span><span class="p">,</span> <span class="n">dv</span> <span class="o">=</span> <span class="n">ufl</span><span class="o">.</span><span class="n">TestFunction</span><span class="p">(</span><span class="n">V</span><span class="p">),</span> <span class="n">ufl</span><span class="o">.</span><span class="n">TrialFunction</span><span class="p">(</span><span class="n">V</span><span class="p">)</span>
    <span class="n">a_form</span> <span class="o">=</span> <span class="n">ufl</span><span class="o">.</span><span class="n">inner</span><span class="p">(</span><span class="n">ufl</span><span class="o">.</span><span class="n">avg</span><span class="p">(</span><span class="n">v_</span><span class="p">),</span> <span class="n">ufl</span><span class="o">.</span><span class="n">avg</span><span class="p">(</span><span class="n">dv</span><span class="p">))</span> <span class="o">*</span> <span class="n">dS</span> <span class="o">+</span> <span class="n">ufl</span><span class="o">.</span><span class="n">inner</span><span class="p">(</span><span class="n">v_</span><span class="p">,</span> <span class="n">dv</span><span class="p">)</span> <span class="o">*</span> <span class="n">ds</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="n">L_form</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span>
            <span class="p">[</span><span class="n">ufl</span><span class="o">.</span><span class="n">inner</span><span class="p">(</span><span class="n">ufl</span><span class="o">.</span><span class="n">avg</span><span class="p">(</span><span class="n">v_</span><span class="p">),</span> <span class="n">val</span><span class="p">)</span> <span class="o">*</span> <span class="n">dS</span><span class="p">(</span><span class="n">reg</span><span class="p">)</span> <span class="k">for</span> <span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span> <span class="ow">in</span> <span class="n">v</span><span class="o">.</span><span class="n">items</span><span class="p">()]</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">L_form</span> <span class="o">=</span> <span class="n">ufl</span><span class="o">.</span><span class="n">inner</span><span class="p">(</span><span class="n">ufl</span><span class="o">.</span><span class="n">avg</span><span class="p">(</span><span class="n">v_</span><span class="p">),</span> <span class="n">v</span><span class="p">)</span> <span class="o">*</span> <span class="n">dS</span>
        
    <span class="n">u</span> <span class="o">=</span> <span class="n">fem</span><span class="o">.</span><span class="n">Function</span><span class="p">(</span><span class="n">V</span><span class="p">)</span>

    <span class="n">problem</span> <span class="o">=</span> <span class="n">fem</span><span class="o">.</span><span class="n">petsc</span><span class="o">.</span><span class="n">LinearProblem</span><span class="p">(</span>
        <span class="n">a_form</span><span class="p">,</span> <span class="n">L_form</span><span class="p">,</span> <span class="n">u</span><span class="o">=</span><span class="n">u</span><span class="p">,</span> <span class="n">petsc_options</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;ksp_type&quot;</span><span class="p">:</span> <span class="s2">&quot;preonly&quot;</span><span class="p">,</span> <span class="s2">&quot;pc_type&quot;</span><span class="p">:</span> <span class="s2">&quot;lu&quot;</span><span class="p">}</span>
    <span class="p">)</span>
    <span class="n">problem</span><span class="o">.</span><span class="n">solve</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">u</span>
</pre></div>
</div>
</div>
</div>
<p>We illustrate how does <code class="docutils literal notranslate"><span class="pre">cell_project</span></code> works by building a cellwise constant function <code class="docutils literal notranslate"><span class="pre">E</span></code> representing the material Young modulus and taking a value of <code class="docutils literal notranslate"><span class="pre">3.09e3</span></code> on the matrix region (labelled 1) and <code class="docutils literal notranslate"><span class="pre">10e3</span></code> on the inclusion region (labelled 2).  We do the same for the Poisson ratio and then define the functions for the bulk elastic constitutive equation.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">E</span> <span class="o">=</span> <span class="n">create_piecewise_constant_field</span><span class="p">(</span><span class="n">domain</span><span class="p">,</span> <span class="n">subdomains</span><span class="p">,</span> <span class="p">{</span><span class="mi">1</span><span class="p">:</span> <span class="mf">3.09e3</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span> <span class="mf">10e3</span><span class="p">})</span>
<span class="n">nu</span> <span class="o">=</span> <span class="n">create_piecewise_constant_field</span><span class="p">(</span><span class="n">domain</span><span class="p">,</span> <span class="n">subdomains</span><span class="p">,</span> <span class="p">{</span><span class="mi">1</span><span class="p">:</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span> <span class="mf">0.4</span><span class="p">})</span>

<span class="n">lmbda</span> <span class="o">=</span> <span class="n">E</span> <span class="o">*</span> <span class="n">nu</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">nu</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">nu</span><span class="p">)</span>
<span class="n">mu</span> <span class="o">=</span> <span class="n">E</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">nu</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">eps</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">ufl</span><span class="o">.</span><span class="n">sym</span><span class="p">(</span><span class="n">ufl</span><span class="o">.</span><span class="n">grad</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">sigma</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">lmbda</span> <span class="o">*</span> <span class="n">ufl</span><span class="o">.</span><span class="n">tr</span><span class="p">(</span><span class="n">eps</span><span class="p">(</span><span class="n">v</span><span class="p">))</span> <span class="o">*</span> <span class="n">ufl</span><span class="o">.</span><span class="n">Identity</span><span class="p">(</span><span class="n">gdim</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">mu</span> <span class="o">*</span> <span class="n">eps</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We now use the <code class="docutils literal notranslate"><span class="pre">facet_project</span></code> function to define a function on the facet space <code class="docutils literal notranslate"><span class="pre">V_f</span></code> which will take physical values on the region 3 corresponding to the interface and higher ones on the facets of the bulk domain, that is region 0.</p>
<p>Note that, UFL requires to restrict facet functions when used in forms. We therefore use the <code class="docutils literal notranslate"><span class="pre">avg</span></code> function to obtain a restricted expression (<code class="docutils literal notranslate"><span class="pre">(+)</span></code> or <code class="docutils literal notranslate"><span class="pre">(-)</span></code> would also have worked in this case).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Gc_list</span> <span class="o">=</span> <span class="p">{</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span><span class="mf">1.5</span><span class="p">}</span>
<span class="n">Gc</span> <span class="o">=</span> <span class="n">facet_project</span><span class="p">(</span><span class="n">Gc_list</span><span class="p">,</span> <span class="n">V_f</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">Gc</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">array</span><span class="p">))</span>
<span class="n">sig_list</span> <span class="o">=</span> <span class="p">{</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span> <span class="mf">400.</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span> <span class="mf">50.0</span><span class="p">}</span>
<span class="n">sig_max</span> <span class="o">=</span> <span class="n">ufl</span><span class="o">.</span><span class="n">avg</span><span class="p">(</span><span class="n">facet_project</span><span class="p">(</span><span class="n">sig_list</span><span class="p">,</span> <span class="n">V_f</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{0.5, 0.5000000000000001, 2.775557561562892e-17, 0.5000000000000002, 1.6999999999999995, 1.7000000000000008, 0.8000000000000002, 0.0, 0.7999999999999998, 1.9999999999999998, 2.0, 1.6999999999999966, 1.7000000000000024, 1.9825411154020653e-17, 1.9825411154020656e-17, 0.8000000000000009, 2.3129646346357432e-17, 0.7999999999999988}
</pre></div>
</div>
</div>
</div>
</section>
<section id="id1">
<h3>Traction-separation law<a class="headerlink" href="#id1" title="Permalink to this heading">#</a></h3>
<p>We then define various functions which will serve for expressing the cohesive law.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">delta_0</span> <span class="o">=</span> <span class="n">Gc</span><span class="o">/</span><span class="n">sig_max</span><span class="o">/</span><span class="n">exp</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">beta</span> <span class="o">=</span> <span class="n">Constant</span><span class="p">(</span><span class="mf">2.</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">normal_opening</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">dot</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">tangential_opening</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">v</span> <span class="o">-</span> <span class="n">normal_opening</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span><span class="o">*</span><span class="n">n</span>
<span class="k">def</span> <span class="nf">effective_opening</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">normal_opening</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">beta</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">tangential_opening</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">T</span><span class="p">(</span><span class="n">opening</span><span class="p">,</span> <span class="n">g_max</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">Gc</span><span class="o">/</span><span class="n">delta_0</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">g_max</span><span class="o">/</span><span class="n">delta_0</span><span class="p">)</span><span class="o">*</span><span class="n">opening</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">8</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">delta_0</span> <span class="o">=</span> <span class="n">Gc</span><span class="o">/</span><span class="n">sig_max</span><span class="o">/</span><span class="n">exp</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="n">beta</span> <span class="o">=</span> <span class="n">Constant</span><span class="p">(</span><span class="mf">2.</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span> <span class="k">def</span> <span class="nf">normal_opening</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>

<span class="ne">NameError</span>: name &#39;exp&#39; is not defined
</pre></div>
</div>
</div>
</div>
</section>
<section id="dirichlet-boundary-conditions">
<h3>Dirichlet boundary conditions<a class="headerlink" href="#dirichlet-boundary-conditions" title="Permalink to this heading">#</a></h3>
<p>Here, we define the Dirichlet boundary conditions consisting here of fixed displacement on the left part and imposed displacement <span class="math notranslate nohighlight">\((t,0)\)</span> on the right boundary. Note that since we use DG discretization of the displacement field, the way to search for the dofs in the <code class="docutils literal notranslate"><span class="pre">DirichletBC</span></code> function must be enforced to be <code class="docutils literal notranslate"><span class="pre">&quot;pointwise&quot;</span></code> (see <a class="reference external" href="https://fenicsproject.org/qa/1905/dirichlet-boundary-condition-fail-in-dg-simulation/">this comment</a>). This forbids the use of a <code class="docutils literal notranslate"><span class="pre">SubDomain</span></code> when defining the region in the corresponding <code class="docutils literal notranslate"><span class="pre">DirichletBC</span></code>. As a result, we need to manually locate the boundary with a Python function.</p>
<p>Finally, we will also need to impose the homogeneous version of the boundary conditions (i.e. with imposed displacements equal to zero). To do so in a generic fashion, we create a list of copies of the previous <code class="docutils literal notranslate"><span class="pre">DirichletBC</span></code> and use the <code class="docutils literal notranslate"><span class="pre">homogenize</span></code> method.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">DU</span> <span class="o">=</span> <span class="n">Expression</span><span class="p">((</span><span class="s2">&quot;t&quot;</span><span class="p">,</span> <span class="s2">&quot;0&quot;</span><span class="p">),</span> <span class="n">t</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">degree</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">bc</span> <span class="o">=</span> <span class="p">[</span><span class="n">DirichletBC</span><span class="p">(</span><span class="n">V_u</span><span class="p">,</span> <span class="n">Constant</span><span class="p">((</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">)),</span> <span class="n">Left</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;pointwise&quot;</span><span class="p">),</span>
      <span class="n">DirichletBC</span><span class="p">(</span><span class="n">V_u</span><span class="p">,</span> <span class="n">DU</span><span class="p">,</span> <span class="n">Right</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;pointwise&quot;</span><span class="p">)]</span>
<span class="n">bc0</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">bci</span> <span class="ow">in</span> <span class="n">bc</span><span class="p">:</span>
    <span class="n">bch</span> <span class="o">=</span> <span class="n">DirichletBC</span><span class="p">(</span><span class="n">bci</span><span class="p">)</span>
    <span class="n">bch</span><span class="o">.</span><span class="n">homogenize</span><span class="p">()</span>
    <span class="n">bc0</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bch</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="variational-form-and-linear-solver">
<h3>Variational form and linear solver<a class="headerlink" href="#variational-form-and-linear-solver" title="Permalink to this heading">#</a></h3>
<p>The variational form is now formulated as: Find <span class="math notranslate nohighlight">\(\bu\in V\)</span> such that:</p>
<div class="amsmath math notranslate nohighlight" id="equation-43f0f1da-d32f-45b2-aa2b-ed68133f059b">
<span class="eqno">()<a class="headerlink" href="#equation-43f0f1da-d32f-45b2-aa2b-ed68133f059b" title="Permalink to this equation">#</a></span>\[\begin{equation}
\int_{\Omega} \boldsymbol{\sigma}(\bu):\boldsymbol{\varepsilon}(\bv)d\Omega + \int_{\Gamma} \boldsymbol{T}([\![\bu]\!],g_{max})\cdot[\![\bv]\!] dS = F_{ext}(\bv) \quad \forall \bv \in V
\end{equation}\]</div>
<p>where <span class="math notranslate nohighlight">\(F_{ext}\)</span> is the work of applied external loads (zero in the present example), <span class="math notranslate nohighlight">\(\Omega\)</span> denotes the domain and <span class="math notranslate nohighlight">\(\Gamma\)</span> the cohesive interfaces which are located here across all elements and, in particular, on the interface. For fixed <span class="math notranslate nohighlight">\(g_{max}\)</span>, the problem is linear and will be solved as such. Once a new displacement has been found, <span class="math notranslate nohighlight">\(g_{max}\)</span> will be updated until convergence for a given load step.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="n">inner</span><span class="p">(</span><span class="n">sigma</span><span class="p">(</span><span class="n">du</span><span class="p">),</span> <span class="n">eps</span><span class="p">(</span><span class="n">u_</span><span class="p">))</span><span class="o">*</span><span class="n">dx</span> <span class="o">+</span> <span class="n">inner</span><span class="p">(</span><span class="n">T</span><span class="p">(</span><span class="n">jump</span><span class="p">(</span><span class="n">du</span><span class="p">),</span> <span class="n">avg</span><span class="p">(</span><span class="n">g_max</span><span class="p">)),</span> <span class="n">jump</span><span class="p">(</span><span class="n">u_</span><span class="p">))</span><span class="o">*</span><span class="n">dS</span>
<span class="n">Fext</span> <span class="o">=</span> <span class="n">Constant</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">*</span><span class="n">u_</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">dx</span>

<span class="n">lin_problem</span> <span class="o">=</span> <span class="n">LinearVariationalProblem</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">Fext</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">bc</span><span class="p">)</span>
<span class="n">lin_solver</span> <span class="o">=</span> <span class="n">LinearVariationalSolver</span><span class="p">(</span><span class="n">lin_problem</span><span class="p">)</span>
<span class="n">lin_solver</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;linear_solver&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;mumps&quot;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Calling FFC just-in-time (JIT) compiler, this may take some time.
</pre></div>
</div>
</div>
</div>
</section>
<section id="load-stepping-loop">
<h3>Load-stepping loop<a class="headerlink" href="#load-stepping-loop" title="Permalink to this heading">#</a></h3>
<p>The load stepping loop is now started with progressively applied imposed displacement. For each load step, an inner fixed-point iteration loop is performed to update the maximum opening and compute the new displacement until convergence. Convergence is measured from the residual of the above variational formulation (we use <code class="docutils literal notranslate"><span class="pre">action</span></code> to compute the action of the bilinear form in the solution). After assembling this residual, we need to account for boundary conditions using their homogeneous version.</p>
<p>At the end of each time step, the total resulting force on the right boundary is computed as well as <span class="math notranslate nohighlight">\(\int_{\Gamma}g_\text{max} dS\)</span> as a measure of opening on a surface <span class="math notranslate nohighlight">\(\Gamma\)</span>. In the following, <span class="math notranslate nohighlight">\(\Gamma\)</span> will either correspond to the interface facets or the internal bulk facets. In this post-processing computation, we consider only facets for which damage has already started, to avoid accounting elastic opening of non-damaged interfaces. We use a threshold of <span class="math notranslate nohighlight">\(g_\text{max} &gt; \delta_0/10\)</span> to consider that a facet has started to damage.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Nincr</span> <span class="o">=</span> <span class="mi">60</span>
<span class="n">Niter_max</span> <span class="o">=</span> <span class="mi">200</span>
<span class="n">tol</span> <span class="o">=</span> <span class="mf">1e-4</span>
<span class="n">opening</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]]</span>
<span class="n">Force</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">iterations</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="n">loading</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.06</span><span class="p">,</span> <span class="n">Nincr</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>


<span class="n">file_name</span> <span class="o">=</span> <span class="s2">&quot;czm_results.xdmf&quot;</span>
<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">file_name</span><span class="p">):</span>
    <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span>
    <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">file_name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.xdmf&quot;</span><span class="p">,</span> <span class="s2">&quot;.h5&quot;</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;File hase been found and deleted.&quot;</span><span class="p">)</span>

<span class="n">ffile</span> <span class="o">=</span> <span class="n">XDMFFile</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span>
<span class="n">ffile</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;flush_output&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">ffile</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="s2">&quot;functions_share_mesh&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
<span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">loading</span><span class="p">[</span><span class="mi">1</span><span class="p">:]):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Load step&quot;</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">DU</span><span class="o">.</span><span class="n">t</span> <span class="o">=</span> <span class="n">t</span>
    <span class="n">nRes</span> <span class="o">=</span> <span class="mf">1.</span>
    <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">Niter_max</span><span class="p">:</span>
        <span class="n">lin_solver</span><span class="o">.</span><span class="n">solve</span><span class="p">()</span>
        <span class="n">g_max</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">facet_project</span><span class="p">(</span><span class="n">effective_opening</span><span class="p">(</span><span class="n">jump</span><span class="p">(</span><span class="n">u</span><span class="p">),</span> <span class="n">n</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)),</span> <span class="n">V_f</span><span class="p">))</span>
        <span class="n">Res</span> <span class="o">=</span> <span class="n">assemble</span><span class="p">(</span><span class="n">action</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">u</span><span class="p">)</span> <span class="o">-</span> <span class="n">Fext</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">bci</span> <span class="ow">in</span> <span class="n">bc0</span><span class="p">:</span>
            <span class="n">bci</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">Res</span><span class="p">)</span>
        <span class="n">nRes</span> <span class="o">=</span> <span class="n">Res</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="s2">&quot;l2&quot;</span><span class="p">)</span>
        <span class="n">j</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;    Iteration </span><span class="si">{}</span><span class="s2"> | Residual: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">nRes</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">nRes</span> <span class="o">&lt;</span> <span class="n">tol</span><span class="p">:</span>
            <span class="k">break</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;Fixed-point solver did not converge in less than </span><span class="si">{}</span><span class="s2"> iterations&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">Niter_max</span><span class="p">))</span>
    <span class="n">iterations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
    <span class="n">clear_output</span><span class="p">(</span><span class="n">wait</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">Force</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">assemble</span><span class="p">(</span><span class="n">sigma</span><span class="p">(</span><span class="n">u</span><span class="p">)[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">ds</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span>
    <span class="n">carac_function</span> <span class="o">=</span> <span class="n">conditional</span><span class="p">(</span><span class="n">gt</span><span class="p">(</span><span class="n">avg</span><span class="p">(</span><span class="n">g_max</span><span class="p">),</span> <span class="n">delta_0</span><span class="o">/</span><span class="mi">10</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">opening</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">assemble</span><span class="p">(</span><span class="n">carac_function</span><span class="o">*</span><span class="n">avg</span><span class="p">(</span><span class="n">g_max</span><span class="p">)</span><span class="o">*</span><span class="n">dS</span><span class="p">(</span><span class="n">k</span><span class="p">))</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">]])</span>

    <span class="n">ffile</span><span class="o">.</span><span class="n">write_checkpoint</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="s2">&quot;Displacement&quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">append</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">ffile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Load step 60
    Iteration 1 | Residual: 1.7988890216671176e-06
</pre></div>
</div>
</div>
</div>
<p>In the above implementation, displacement fields have been saved in an XDMF file for Paraview visualization.</p>
<blockquote>
<div><p>Note that Paraview cannot read DG-1 functions when using <code class="docutils literal notranslate"><span class="pre">write</span></code> as they will be automatically projected onto a CG-1 space. To read arbitrary discontinuous Lagrange elements, we need to use <code class="docutils literal notranslate"><span class="pre">write_checkpoint</span></code>. We also use the <code class="docutils literal notranslate"><span class="pre">append=True</span></code> keyword to append every time step to the same file. For this reason, we also need to delete the file at the beginning of the simulation if the file already exists. Otherwise, current time steps will be appended to the results of a previous simulation.</p>
</div></blockquote>
</section>
<section id="force-displacement-and-opening-evolutions">
<h3>Force-displacement and opening evolutions<a class="headerlink" href="#force-displacement-and-opening-evolutions" title="Permalink to this heading">#</a></h3>
<p>As showcased in the initial GIF animation, the matrix/inclusion interface first starts to open almost elastically, then a sudden drop in the force-displacement curve corresponds to the unstable debonding of a large portion of both interfaces. The remaining load-carrying part of the structure then continues to stretch until a sudden final fracture of the central region.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">loading</span><span class="p">,</span> <span class="n">Force</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Imposed displacement&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Reaction force&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">loading</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">opening</span><span class="p">)[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;-C1&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Interface opening&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">loading</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">opening</span><span class="p">)[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;-C2&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Bulk opening&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Imposed displacement&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Cumulated opening&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>findfont: Font family [&#39;serif&#39;] not found. Falling back to DejaVu Sans.
</pre></div>
</div>
<img alt="../../../_images/2003077d51a6a73a1bbc3f2c5b33a37e51d14987cdd30ea6b990dbb25f2d36a4.png" src="../../../_images/2003077d51a6a73a1bbc3f2c5b33a37e51d14987cdd30ea6b990dbb25f2d36a4.png" />
</div>
</div>
</section>
</section>
<section id="references">
<h2>References<a class="headerlink" href="#references" title="Permalink to this heading">#</a></h2>
<p>[HAN15] Hansbo, P., &amp; Salomonsson, K. (2015). A discontinuous Galerkin method for cohesive zone modelling. Finite Elements in Analysis and Design, 102, 1-6.</p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./tours/nonlinear_problems/cohesive_zone_model"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#traction-separation-law">Traction-separation law</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#nonlinear-resolution">Nonlinear resolution</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#fenics-implementation">FEniCS implementation</a><ul class="visible nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#mesh-and-domains">Mesh and domains</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#function-spaces-and-functions">Function spaces and functions</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#projection-onto-cells-and-facets">Projection onto cells and facets</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Traction-separation law</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#dirichlet-boundary-conditions">Dirichlet boundary conditions</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#variational-form-and-linear-solver">Variational form and linear solver</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#load-stepping-loop">Load-stepping loop</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#force-displacement-and-opening-evolutions">Force-displacement and opening evolutions</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#references">References</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Jeremy Bleyer
</p>

  </div>
  
  <div class="footer-item">
    

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../../_static/scripts/bootstrap.js?digest=5b4479735964841361fd"></script>
<script src="../../../_static/scripts/pydata-sphinx-theme.js?digest=5b4479735964841361fd"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>